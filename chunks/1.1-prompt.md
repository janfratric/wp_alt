# Chunk 1.1 — Project Scaffolding & Core Framework

## Goal

Build the LiteCMS skeleton: directory structure, Composer autoloading, config system, and micro-framework core (router, request/response, middleware pipeline, template engine, app container). At completion, HTTP requests route to handlers, templates render with layouts, and middleware executes in order.

## Context Files

- `PROMPT.md` — Full project specification (tech stack, constraints, security requirements)
- `CHUNK-1.1-PLAN.md` — Detailed reference with full code templates (consult if stuck)
- `tests/chunk-1.1-verify.php` — Automated tests you MUST pass before declaring done

## Files to Create (in dependency order)

| # | File | Purpose |
|---|------|---------|
| 1 | `composer.json` | PSR-4 autoloading (`App\` → `app/`), PHP >=8.1, no dependencies |
| 2 | `.env.example` | Environment variable template |
| 3 | `.gitignore` | Ignore vendor/, .env, storage/database.sqlite, uploads, logs |
| 4 | `config/app.php` | Returns config array, reads from `getenv()` with fallback defaults |
| 5 | `app/Core/Config.php` | Static config reader with typed getters |
| 6 | `app/Core/Request.php` | HTTP request wrapper |
| 7 | `app/Core/Response.php` | HTTP response builder |
| 8 | `app/Core/Router.php` | Regex-based URL router |
| 9 | `app/Core/Middleware.php` | Middleware pipeline runner |
| 10 | `app/Templates/TemplateEngine.php` | PHP template renderer with layout support |
| 11 | `app/Core/App.php` | Application container and dispatcher |
| 12 | `public/.htaccess` | Apache rewrite to index.php |
| 13 | `.htaccess` (root) | Deny access to non-public files |
| 14 | `public/index.php` | Single entry point with demo routes |
| 15 | `templates/public/layout.php` | Base HTML5 layout |
| 16 | `templates/public/home.php` | Homepage template |
| 17 | `templates/admin/layout.php` | Admin layout placeholder |
| 18 | `templates/admin/dashboard.php` | Dashboard placeholder |
| 19 | Directories with `.gitkeep` | storage/logs/, storage/cache/, public/assets/css/, public/assets/js/, public/assets/uploads/, templates/auth/, migrations/ |

## Class Signatures

### `App\Core\Config`
```
static get(string $key, mixed $default = null): mixed
static getString(string $key, string $default = ''): string
static getInt(string $key, int $default = 0): int
static getBool(string $key, bool $default = false): bool
static all(): array
```
Lazy-loads `config/app.php` on first access. Private static `?array $config`.

### `App\Core\Request`
```
__construct()                                         // Captures $_GET, $_POST, $_SERVER, $_COOKIE
method(): string                                      // GET/POST/PUT/DELETE (supports _method override)
uri(): string                                         // Path without query string, trailing slash trimmed
input(string $key, mixed $default = null): mixed      // From POST
query(string $key, mixed $default = null): mixed      // From GET
all(): array                                          // Merged GET+POST
cookie(string $key, mixed $default = null): mixed
server(string $key, mixed $default = null): mixed
isMethod(string $method): bool
isAjax(): bool
```
Trims string inputs. Supports subdirectory installs (strip SCRIPT_NAME base from URI). `_method` override only for PUT/DELETE.

### `App\Core\Response`
```
__construct(string $body = '', int $status = 200, array $headers = [])
static html(string $body, int $status = 200): self
static json(mixed $data, int $status = 200): self     // JSON_THROW_ON_ERROR | JSON_UNESCAPED_UNICODE
static redirect(string $url, int $status = 302): self
withHeader(string $name, string $value): self          // Fluent
withStatus(int $code): self                            // Fluent
send(): void                                           // http_response_code + headers + echo body
getBody(): string
getStatus(): int
getHeaders(): array
```

### `App\Core\Router`
```
get(string $pattern, callable|array $handler): void
post(string $pattern, callable|array $handler): void
put(string $pattern, callable|array $handler): void
delete(string $pattern, callable|array $handler): void
group(string $prefix, callable $callback): void
dispatch(string $method, string $uri): ?array          // Returns ['handler' => ..., 'params' => [...]] or null
```
Patterns use `{paramName}` → converted to `(?P<paramName>[^/]+)` regex. Handlers are closures or `[Class::class, 'method']` arrays.

### `App\Core\Middleware`
```
static run(Request $request, array $middlewares, callable $handler): Response
```
Builds nested chain by reducing middleware array from right to left. Each middleware: `fn(Request, callable $next): Response`.

### `App\Templates\TemplateEngine`
```
__construct(string $basePath)
render(string $template, array $data = []): string
```
Template-internal (via `$this`):
```
layout(string $template): void       // Declare parent layout
content(): string                    // Output child content (used in layouts)
partial(string $template, array $data = []): string
e(string $value): string             // htmlspecialchars(ENT_QUOTES, UTF-8)
```
Uses output buffering. If template calls `$this->layout(...)`, render wraps output in that layout.

### `App\Core\App`
```
__construct()                        // Creates Router, TemplateEngine, sets timezone
router(): Router
template(): TemplateEngine
register(string $key, mixed $value): void
resolve(string $key): mixed
addMiddleware(callable $middleware): void
run(Request $request): void          // Dispatch → middleware pipeline → send response
```
Controllers receive App instance in constructor. Closure handlers receive `($request, ...$params)`. No match → 404 response.

## Key Constraints

- Every `.php` file starts with `<?php declare(strict_types=1);`
- No framework imports — native PHP only
- No sessions, cookies, or database in this chunk
- PSR-4 namespacing: `App\Core\Config` → `app/Core/Config.php`
- Templates use `$this->e()` for all user-facing output (XSS prevention)
- Must handle subdirectory installs in Request URI parsing

## Verification

After implementation, run:
```
composer install
php tests/chunk-1.1-verify.php
```

All tests must show `[PASS]`. Fix any `[FAIL]` before declaring this chunk complete.

Then verify manually:
```
php -S localhost:8000 -t public
```
- `GET /` → 200, rendered homepage with layout
- `GET /nonexistent` → 404
- `GET /admin/dashboard` → 200, admin layout

## Reference

For full code templates and detailed implementation notes, see `CHUNK-1.1-PLAN.md`.
