# Chunk 2.1 â€” Admin Layout & Dashboard

## Goal

Build the admin panel shell: styled sidebar navigation with active-state highlighting, responsive layout with top bar, and a dashboard page showing content statistics (counts by type/status) and recent items from the database. This establishes the visual foundation for all future admin pages. At completion, the admin sees a polished, responsive dashboard after login with working navigation links.

## Context Files

- `PROMPT.md` â€” Full project specification (tech stack, constraints, security requirements)
- `CHUNK-2.1-PLAN.md` â€” Detailed reference with full code templates (consult if stuck)
- `tests/chunk-2.1-verify.php` â€” Automated tests you MUST pass before declaring done
- `app/Core/App.php` â€” App container (controllers receive App in constructor)
- `app/Database/QueryBuilder.php` â€” Fluent query builder (`query()`, `select()`, `where()`, `count()`, `get()`, `leftJoin()`, `orderBy()`, `limit()`)
- `app/Templates/TemplateEngine.php` â€” Template engine (`render()`, `layout()`, `content()`, `partial()`, `e()`, `csrfField()`)
- `app/Auth/Session.php` â€” Session with `flash()` for flash messages
- `templates/admin/layout.php` â€” Current minimal layout (to be replaced)
- `public/index.php` â€” Current entry point with dashboard closure route (to be modified)

## Files to Create/Modify (in dependency order)

| # | File | Action | Purpose |
|---|------|--------|---------|
| 1 | `public/assets/css/admin.css` | CREATE | Complete admin stylesheet â€” CSS custom properties, sidebar, topbar, stats grid, tables, badges, buttons, forms, alerts, responsive breakpoints |
| 2 | `public/assets/js/admin.js` | CREATE | Sidebar mobile toggle, delete confirmation via `data-confirm` attr, auto-dismiss flash messages |
| 3 | `app/Admin/DashboardController.php` | CREATE | Queries DB for content/user/media stats + recent content, renders dashboard with CSP headers |
| 4 | `templates/admin/layout.php` | REPLACE | Full sidebar nav (5 links with `$activeNav` highlighting), top bar, mobile responsive, linked CSS/JS, class-based flash messages |
| 5 | `templates/admin/dashboard.php` | REPLACE | Stats grid (5 cards) + recent content table with author join |
| 6 | `templates/admin/placeholder.php` | CREATE | Generic "coming soon" page for nav links without controllers |
| 7 | `public/index.php` | EDIT | Dashboard route â†’ controller, add placeholder routes for Content/Media/Users/Settings |

## Class Signatures

### `App\Admin\DashboardController`
```
__construct(App $app)
index(Request $request): Response
```
`index()` queries:
- `QueryBuilder::query('content')->select()->count()` â€” total, published, draft, page, post counts
- `QueryBuilder::query('users')->select()->count()` â€” user count
- `QueryBuilder::query('media')->select()->count()` â€” media count
- `QueryBuilder::query('content')->select('content.*', 'users.username as author_name')->leftJoin('users', 'users.id', '=', 'content.author_id')->orderBy('content.updated_at', 'DESC')->limit(5)->get()` â€” recent items

Returns `Response::html($html)->withHeader('X-Frame-Options', 'DENY')->withHeader('Content-Security-Policy', "default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self'")`.

## Template Variables

### `admin/layout.php` expects:
- `$title` (string) â€” page title for `<title>` and topbar
- `$activeNav` (string) â€” one of: `'dashboard'`, `'content'`, `'media'`, `'users'`, `'settings'`
- Reads `$_SESSION['user_name']` and `$_SESSION['user_role']` directly

### `admin/dashboard.php` expects:
- `$totalContent`, `$publishedCount`, `$draftCount`, `$pageCount`, `$postCount`, `$userCount`, `$mediaCount` (all int)
- `$recentContent` (array of rows with keys: `title`, `type`, `status`, `author_name`, `updated_at`, `created_at`)

### `admin/placeholder.php` expects:
- `$title` (string), `$activeNav` (string), `$message` (string)

## Key Constraints

- Every `.php` file: `<?php declare(strict_types=1);` (templates excepted â€” they are included by the engine)
- Controller follows existing pattern: constructor receives `App $app`, methods receive `Request`, return `Response`
- Navigation uses Unicode characters for icons (no icon library) â€” â–  âœŽ ðŸ“· ðŸ‘¥ âš™
- All user output escaped with `$this->e()` or cast to `(int)` â€” no raw variables in templates
- CSS uses custom properties for theming; no CSS framework dependency
- No inline styles in templates â€” all styling via `admin.css` classes
- Responsive: sidebar slides off-screen at `<=768px`, toggled by JS; overlay covers content
- Flash messages use `.alert .alert-error` / `.alert-success` classes (replacing inline styles from Chunk 1.3 layout)
- CSP and X-Frame-Options headers set on dashboard response
- Placeholder routes must exist for all sidebar nav links to prevent 404s

## Verification

After implementation, run:
```
composer install
php tests/chunk-2.1-verify.php
```

All tests must show `[PASS]`. Fix any `[FAIL]` before declaring done.

Then run full regression:
```
php tests/run-all.php --full
```

All previous chunks (1.1, 1.2, 1.3) must still pass.

Manual verification:
```
php -S localhost:8000 -t public
```
- Log in as admin/admin â†’ redirected to `/admin/dashboard`
- Dashboard shows stats cards (all zeros on fresh install except Users = 1)
- Sidebar has 5 nav links, "Dashboard" is highlighted
- Click each nav link â€” no 404s, placeholder pages load with correct active state
- Resize to mobile â€” sidebar collapses, hamburger toggle works
- Check response headers for `X-Frame-Options` and `Content-Security-Policy`

## Reference

For full code templates, CSS source, and detailed implementation notes, see `CHUNK-2.1-PLAN.md`.
